{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nexport default {\n  data() {\n    return {\n      overlay: true,\n      script: `https://checkout.razorpay.com/v1/checkout.js`,\n      order_id: null,\n      signature: null,\n      pay_id: null,\n      url: this.$store.getters.getUrl,\n      proceed: 'You are being redirected to payment gateway.',\n      razorPayScript: null\n    };\n  },\n  computed: {\n    details() {\n      return this.$store.getters.getDetails;\n    },\n    razor() {\n      return this.$store.getters.getRazor;\n    }\n  },\n  methods: {\n    async loadRazorPay() {\n      return new Promise(resolve => {\n        const script = document.createElement('script');\n        script.src = this.script;\n        script.onload = () => {\n          resolve(true);\n          this.overlay = false;\n        };\n        script.onerror = () => {\n          resolve(false);\n        };\n        document.body.appendChild(script);\n        this.razorpayScript = script;\n      });\n    },\n    removeRazorPayScript() {\n      // Remove the Razorpay script element from the DOM\n      if (this.razorpayScript && this.razorpayScript.parentNode) {\n        this.razorpayScript.parentNode.removeChild(this.razorpayScript);\n        const elementsToRemove = document.body.getElementsByClassName('razorpay-container');\n\n        // Convert HTMLCollection to array and loop through each element to remove it\n        Array.from(elementsToRemove).forEach(element => {\n          element.remove();\n        });\n      }\n    }\n  },\n  async created() {\n    const result = await this.loadRazorPay();\n    if (!result) {\n      alert('Failed to load razorpay script');\n      return;\n    }\n    const options = {\n      key: this.razor.razorpayKeyId,\n      amount: this.razor.amount,\n      currency: this.razor.currency,\n      name: `Aksharam Museum`,\n      description: `Description of the payment`,\n      order_id: this.razor.orderId,\n      handler: async response => {\n        this.pay_id = response.razorpay_payment_id;\n        this.order_id = response.razorpay_order_id;\n        this.signature = response.razorpay_signature;\n        this.$store.commit('setPayment', this.pay_id);\n        // console.log(this.pay_id);\n        try {\n          const response1 = await axios.post(`${this.url}/api/payment/verify-payment`, {\n            \"orderId\": this.order_id,\n            \"paymentId\": this.pay_id,\n            \"signature\": this.signature\n          });\n          if (response1.status === 200) {\n            this.$router.push('/loading_ticket');\n          }\n        } catch (error) {\n          console.error(error);\n        }\n      },\n      prefill: {\n        name: this.details.name,\n        email: this.details.email,\n        contact: this.details.mobile\n      },\n      \"theme\": {\n        \"color\": \"#388E3C\"\n      }\n    };\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.on('payment.failed', response => {\n      console.log('Payment failed event triggered');\n      console.log('Response:', response);\n      const proceed = confirm(`${response.error.description}. Do you want to proceed to another payment method?`);\n      console.log('Proceed:', proceed);\n      if (!proceed) {\n        this.proceed = 'You are being redirected to home page.';\n        this.overlay = true;\n        paymentObject.close();\n        setTimeout(() => {\n          sessionStorage.clear();\n          this.removeRazorPayScript();\n          this.$router.push('/');\n        }, 3000);\n      }\n    });\n    paymentObject.open();\n  },\n  beforeUnmount() {\n    this.removeRazorPayScript();\n  }\n};","map":{"version":3,"names":["axios","data","overlay","script","order_id","signature","pay_id","url","$store","getters","getUrl","proceed","razorPayScript","computed","details","getDetails","razor","getRazor","methods","loadRazorPay","Promise","resolve","document","createElement","src","onload","onerror","body","appendChild","razorpayScript","removeRazorPayScript","parentNode","removeChild","elementsToRemove","getElementsByClassName","Array","from","forEach","element","remove","created","result","alert","options","key","razorpayKeyId","amount","currency","name","description","orderId","handler","response","razorpay_payment_id","razorpay_order_id","razorpay_signature","commit","response1","post","status","$router","push","error","console","prefill","email","contact","mobile","paymentObject","window","Razorpay","on","log","confirm","close","setTimeout","sessionStorage","clear","open","beforeUnmount"],"sources":["D:\\Documents\\ticket-booking\\Museum-completed\\src\\components\\RazorPayment.vue"],"sourcesContent":["<template>\r\n  <v-overlay :model-value=\"overlay\" class=\"align-center justify-center\" persistent>\r\n    <div class=\"text-center fst-italic  fw-bold \">\r\n      <p>{{ proceed }}</p>\r\n        <p>Please do not refresh the page.</p>\r\n      <v-progress-circular color=\"primary\" size=\"64\" indeterminate></v-progress-circular>\r\n    </div>\r\n  </v-overlay>\r\n</template>\r\n<script>\r\nimport axios from 'axios'\r\n\r\nexport default {\r\n\r\n  data() {\r\n    return {\r\n      overlay: true,\r\n      script: `https://checkout.razorpay.com/v1/checkout.js`,\r\n      order_id: null,\r\n      signature: null,\r\n      pay_id: null,\r\n      url: this.$store.getters.getUrl,\r\n      proceed: 'You are being redirected to payment gateway.',\r\n      razorPayScript: null\r\n    }\r\n  },\r\n  computed: {\r\n    details() {\r\n      return this.$store.getters.getDetails\r\n    },\r\n    razor() {\r\n      return this.$store.getters.getRazor\r\n    },\r\n  },\r\n  methods: {\r\n    async loadRazorPay() {\r\n      return new Promise(resolve => {\r\n        const script = document.createElement('script')\r\n        script.src = this.script\r\n        script.onload = () => {\r\n          resolve(true);\r\n          this.overlay = false;\r\n        }\r\n        script.onerror = () => {\r\n          resolve(false)\r\n        }\r\n        document.body.appendChild(script)\r\n        this.razorpayScript = script;\r\n      })\r\n    },\r\n    removeRazorPayScript() {\r\n      // Remove the Razorpay script element from the DOM\r\n      if (this.razorpayScript && this.razorpayScript.parentNode) {\r\n        this.razorpayScript.parentNode.removeChild(this.razorpayScript);\r\n        const elementsToRemove = document.body.getElementsByClassName('razorpay-container');\r\n\r\n        // Convert HTMLCollection to array and loop through each element to remove it\r\n        Array.from(elementsToRemove).forEach(element => {\r\n          element.remove();\r\n        });\r\n      }\r\n    }\r\n  },\r\n  async created() {\r\n    const result = await this.loadRazorPay()\r\n    if (!result) {\r\n      alert('Failed to load razorpay script')\r\n      return\r\n    }\r\n    const options = {\r\n      key: this.razor.razorpayKeyId,\r\n      amount: this.razor.amount,\r\n      currency: this.razor.currency,\r\n      name: `Aksharam Museum`,\r\n      description: `Description of the payment`,\r\n      order_id: this.razor.orderId,\r\n\r\n      handler: async (response) => {\r\n        this.pay_id = response.razorpay_payment_id;\r\n        this.order_id = response.razorpay_order_id;\r\n        this.signature = response.razorpay_signature;\r\n        this.$store.commit('setPayment', this.pay_id)\r\n        // console.log(this.pay_id);\r\n        try {\r\n          const response1 = await axios.post(`${this.url}/api/payment/verify-payment`, {\r\n            \"orderId\": this.order_id,\r\n            \"paymentId\": this.pay_id,\r\n            \"signature\": this.signature,\r\n          });\r\n\r\n          if (response1.status === 200) {\r\n            this.$router.push('/loading_ticket')\r\n          }\r\n        }\r\n        catch (error) {\r\n          console.error(error);\r\n        }\r\n      },\r\n      prefill: {\r\n        name: this.details.name,\r\n        email: this.details.email,\r\n        contact: this.details.mobile\r\n      },\r\n      \"theme\": {\r\n        \"color\": \"#388E3C\"\r\n      },\r\n    };\r\n    const paymentObject = new window.Razorpay(options);\r\n    paymentObject.on('payment.failed', (response) => {\r\n      console.log('Payment failed event triggered');\r\n      console.log('Response:', response);\r\n\r\n      const proceed = confirm(`${response.error.description}. Do you want to proceed to another payment method?`);\r\n      console.log('Proceed:', proceed);\r\n\r\n      if (!proceed) {\r\n        this.proceed = 'You are being redirected to home page.'\r\n        this.overlay = true;\r\n        paymentObject.close();\r\n        setTimeout(() => {\r\n          sessionStorage.clear();\r\n          this.removeRazorPayScript(); \r\n          this.$router.push('/');\r\n        }, 3000);\r\n      }\r\n    });\r\n    paymentObject.open();\r\n  },\r\n  beforeUnmount() {\r\n    this.removeRazorPayScript();\r\n  }\r\n};\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}